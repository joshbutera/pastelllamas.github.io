<!DOCTYPE html>
<html>
<meta charset="utf-8">
<link
      href="https://fonts.googleapis.com/css2?family=Dancing+Script:wght@700&display=swap"
      rel="stylesheet"
    />

<head>
   <link rel="stylesheet" href="style.css">
   <link
      href="https://fonts.googleapis.com/css2?family=Dancing+Script:wght@700&display=swap"
      rel="stylesheet"
    />
    <link href="https://fonts.googleapis.com/css2?family=Karma:wght@400;500;600;700&display=swap" rel="stylesheet">
</head>

<head>
   <link rel="stylesheet" href="style.css">
   <link
      href="https://fonts.googleapis.com/css2?family=Dancing+Script:wght@700&display=swap"
      rel="stylesheet"
    />
    <link href="https://fonts.googleapis.com/css2?family=Karma:wght@400;500;600;700&display=swap" rel="stylesheet">
</head>

<body>
   <div class="content">
      <div id="pre-map-text">
         <h1> Happiness vs. Corruption</h1>
         <h2> What is the biggest contributor to happiness?</h2>
         <p> Using a dataset provided by the world happiness report, we wanted to figure out <span class="bolded">what contributes most to a country's happiness.</span>
         For each country, a subset of the population was surveyed where each participant would respond with how happy they are - along
            with what aspects (GDP, family, health, etc.) contribute to that happiness.</p>
         <h3> That leads us to our first question, how does happiness look across the world?</h3>
         <p> The map below uses the average happiness score for each country between 2015 and 2020, where (color) is the happiest countries and (color) is the least happy.</p>
         Year: <select id="mapSelection" class="dropdown"></select><br>
      </div>
      <div id="map"></div>
      <div id="pre-scatter-text">
         <h3> So what is actually contributing to the happiness of each of these countries?</h3>
         <p> As mentioned, surveyors were also asked to respond to what aspects - GDP per capita, family, health ,freedom, generosity, government trust, and corruption - contributed most to their happiness rating.</p>
         <p> The plot below shows the each country's happiness rating on the x-axis, and the average score of a specified aspect on the y-axis.</p>
         <p> The dashed line (the line of best fit) shows how much of an impact the aspect has on the happiness rating - a steeper slope shows a bigger impact.</p>
         Aspect: <select id="scatterSelection" class="dropdown"></select><br>
      </div>
      <div id="scatter"></div>
      <div id="post-scatter-text">
         <h3> Which of the aspects actually had the biggest impact?</h3>
         <p> From switching through the different aspects, it can be seen that GDP, health, and family are the biggest contributors with generosity not having much of an impact at all.</p>
      </div>
      <div id="bar-chart">
         Aspect: <select id="barChartSelection" class="dropdown"></select><br>
      </div>
   </div>
</body>

<style>
   .header {
      position: fixed;
      overflow: hidden;
      background-color: #83C5BE;
      /* padding: 10px 10px; */
      width: 100%;
      left: 0px;
      top: 0px;
      border-bottom: 2px solid #006D77;
      
   }
   
   #scatterSelection {
      margin-top: 100px;
   }

   .axis > path, .axis > g > line {
      color: #006D77;
      stroke-width: 2px;
   }

   .axis > g > text {
      color: #006D77;
      font-size: 12px
   }

   .header * {
      display: flex;
      justify-content: center;
      color: #006D77;
      text-align: center;
      font-family: "Dancing Script", cursive;
      font-size: 30px;
   }

   html {
      background-color: #EDF6F9;
   }
   .tooltip {
      position: relative;
      background: #83C5BE;
      border-radius: 3px;
      border: 1px solid #006D77;
      padding: 5px;
      left: 20;
      visibility: hidden;
      color: black;
      font-family: Arial, Helvetica, sans-serif;
   }
</style>

<script src="https://d3js.org/d3.v7.min.js"></script>
<script src="https://unpkg.com/simple-statistics@7.8.0/dist/simple-statistics.min.js"></script>
<script src="/scatterplot.js"></script>
<script src="/barchart.js"></script>
<script src="/map.js"></script>

<script>
   // Open up on a map of the world with circles representing happiness for each country in the report
   // scrollytelling to show explanations for happiness
   // bottom of page has corruption/happiness where user can select up to certain amount of countries to view happiness over time

   // Function to figure out the width of the page.
   function getWidth() {
      return Math.max(
         document.body.scrollWidth,
         document.documentElement.scrollWidth,
         document.body.offsetWidth,
         document.documentElement.offsetWidth,
         document.documentElement.clientWidth
      )
   }
   var margin = { top: 20, right: 150, bottom: 60, left: 150 };
   var raw_width = getWidth()
   var raw_height = 600
   var width = raw_width - margin.left - margin.right;
   var height = raw_height - margin.top - margin.bottom;
   var dataset = {
      2015: [],
      2016: [],
      2017: [],
      2018: [],
      2019: [],
      2020: []
   }

   var variableOptions = ["gdp_per_capita", "family", "health", "freedom", "generosity", "government_trust", "cpi_score"]
   let scatterVar = variableOptions[0]
   let barVar = variableOptions[0]

   const min_color = "#95d5b2",
      max_color = "#081c15"

   // Initialize the tooltip elements.
   d3.select(".content").append("span").attr("class", "tooltip")
   var scatter_plot = d3.select("#scatter").append("svg")
      .attr("id", "scatter_plot")
      .style("height", raw_height)
      .style("width", raw_width)
      .append("g").attr("transform", "translate(" + margin.left + "," + margin.top + ")")
   
   // Initialize the dropdown menu elements.
   d3.select("#scatterSelection")
      .selectAll('myOptions')
     	.data(variableOptions)
      .enter()
    	.append('option')
      .text(function (d) { return d; }) // text showed in the menu
      .attr("value", function (d) { return d; }) // corresponding value returned by the button

   d3.select("#barChartSelection")
      .selectAll('myOptions')
     	.data(variableOptions)
      .enter()
    	.append('option')
      .text(function (d) { return d; }) // text showed in the menu
      .attr("value", function (d) { return d; }) // corresponding value returned by the button
   
   // Checks when the value of the dropdown menu is changed.
   d3.select("#scatterSelection").on("change", function(d) {
      scatterVar = d3.select(this).property("value")
      drawScatterPlot(scatterVar, dataset)
   })

   d3.select("#barChartSelection").on("change", function(d) {
      barVar = d3.select(this).property("value")
      drawBarChart(barVar, dataset)
   })

   
   // Initialize the bar chart elements.
   var bar_chart = d3.select("#bar-chart").append("svg")
      .style("height", 600)
      .style("width", getWidth())
      .append("g").attr("transform", "translate(" + margin.left + "," + margin.top + ")")

   // dropdown for map visualization 
   var mapVariableOptions = ["All Years", "2015", "2016", "2017", "2018", "2019", "2020"];
   let mapVar = mapVariableOptions[0];

   d3.select("#mapSelection")
      .selectAll('myMapOptions')
     	.data(mapVariableOptions)
      .enter()
    	.append('option')
      .text(function (d) { return d; }) // text showed in the menu
      .attr("value", function (d) { return d; }); // corresponding value returned by the button
   
   // Checks when the value of the dropdown menu is changed.
   d3.select("#mapSelection").on("change", function(d) {
      mapVar = d3.select(this).property("value");
      drawMap(countries, mapVar);
   });

   var world_map = d3.select("#map").append("svg")
      .style("height", 750)
      .style("width", 1000)
      .append("g").attr("transform", "translate(" + 0 + "," + margin.top + ")")
   
   // Ready function to initialize the page.
   async function ready() {
      data = await d3.csv("WorldHappinessData.csv"); // load csv data
      countries = await d3.json("countries.geojson");
      data.forEach(d => {
         dataset[Number(d['Year'])].push(d) // aggregate data by year
      })

      drawMap(countries)
      drawScatterPlot(scatterVar, dataset) // initialize the scatter plot
      drawMap(countries, mapVar) // initialize the map
      drawBarChart(barVar, dataset) // initialize the bar chart

   }

   ready()

</script>
</html>